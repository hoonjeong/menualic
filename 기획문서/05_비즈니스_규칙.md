# 메뉴얼 제작 서비스 - 비즈니스 규칙

---

## 1. 회원 및 계정 관리 규칙

### 1-1. 회원가입
- **조건**: 이메일 형식이 유효하고, 중복되지 않아야 함
- **규칙**: 
  - 비밀번호는 최소 8자 이상, 영문+숫자 조합 필수
  - 이용약관 동의는 필수
- **결과**: 회원 계정 생성 및 로그인 상태로 전환

### 1-2. 초대 링크로 가입
- **조건**: 유효한 초대 링크를 통해 회원가입
- **규칙**: 가입과 동시에 해당 팀에 자동 가입
- **결과**: 
  - 초대받은 권한 (편집자/뷰어) 자동 부여
  - 팀 대시보드로 즉시 이동

### 1-3. 계정 잠금
- **조건**: 로그인 5회 연속 실패
- **규칙**: 계정을 10분간 잠금 처리
- **결과**: "너무 많은 로그인 시도가 있었습니다. 10분 후 다시 시도해주세요" 메시지

---

## 2. 팀 관리 규칙

### 2-1. 팀 생성
- **조건**: 회원가입한 사용자만 가능
- **규칙**: 
  - 한 사용자는 하나의 팀에만 소속 가능
  - 팀을 생성한 사용자는 자동으로 "소유자" 권한 부여
- **결과**: 팀이 생성되고, 팀 대시보드로 이동

### 2-2. 팀 소속 제한
- **조건**: 사용자가 이미 팀에 소속되어 있음
- **규칙**: 다른 팀 초대를 수락할 수 없음
- **결과**: "이미 다른 팀에 속해있어 가입할 수 없습니다" 에러 메시지

### 2-3. 팀원 권한
- **조건**: 팀에 속한 사용자
- **규칙**: 
  - **소유자**: 팀 관리, 팀원 초대/제거, 권한 변경, 메뉴얼 생성/편집/삭제
  - **편집자**: 메뉴얼 생성/편집, 팀원 목록 조회
  - **뷰어**: 메뉴얼 읽기만 가능
- **결과**: 권한에 따라 접근 가능한 기능 제한

### 2-4. 소유자 권한 이전
- **조건**: 현재 소유자가 다른 팀원에게 소유자 권한 부여
- **규칙**: 
  - 팀에는 항상 1명의 소유자만 존재
  - 소유자 권한 이전 시, 기존 소유자는 편집자로 변경
- **결과**: 새로운 소유자 설정 및 기존 소유자 권한 강등

### 2-5. 팀 삭제
- **조건**: 소유자만 가능
- **규칙**: 
  - 팀명을 정확히 입력해야 삭제 가능 (실수 방지)
  - 팀 삭제 시 모든 메뉴얼 및 데이터 영구 삭제
- **결과**: 팀 및 모든 관련 데이터 삭제, 홈으로 이동

---

## 3. 팀원 초대 및 가입 규칙

### 3-1. 이메일 초대
- **조건**: 소유자가 팀원 초대
- **규칙**: 
  - 초대 메일 발송 시 권한 (편집자/뷰어) 지정
  - 동일 이메일로 중복 초대 가능 (재발송)
- **결과**: 초대 메일 발송 및 초대 대기 목록 추가

### 3-2. 링크 초대
- **조건**: 소유자가 초대 링크 생성
- **규칙**: 
  - 링크에는 권한 (편집자/뷰어) 정보 포함
  - 유효기간 설정 가능 (1일/7일/30일/무제한)
  - 링크 만료 시 접근 불가
- **결과**: 링크를 통해 가입한 사용자는 자동으로 해당 팀 가입

### 3-3. 초대 수락 불가
- **조건**: 초대받은 사용자가 이미 다른 팀에 소속
- **규칙**: 한 사용자는 하나의 팀에만 소속 가능
- **결과**: "이미 다른 팀에 속해있어 가입할 수 없습니다" 에러

### 3-4. 팀원 내보내기
- **조건**: 소유자가 팀원 제거
- **규칙**: 
  - 소유자는 자신을 제외한 모든 팀원 제거 가능
  - 내보낸 팀원은 즉시 팀 접근 권한 상실
- **결과**: 해당 사용자의 팀 소속 해제

---

## 4. 메뉴얼 생성 및 편집 규칙

### 4-1. 메뉴얼 생성
- **조건**: 소유자 또는 편집자
- **규칙**: 새 메뉴얼은 기본적으로 비공개 (팀 내부에서도 접근 불가)
- **결과**: 메뉴얼 생성 후 편집 화면으로 이동

### 4-2. 자동 저장
- **조건**: 메뉴얼 편집 중
- **규칙**: 
  - 5초마다 자동 저장
  - 네트워크 오류 시 로컬에 임시 저장 후 재시도
- **결과**: 변경 사항 실시간 반영 및 버전 이력 자동 생성

### 4-3. 블록 제한
- **조건**: 메뉴얼 내 블록 수
- **규칙**: 
  - 하나의 메뉴얼에 최대 500개 블록까지 허용
  - 초과 시 "블록 수 제한에 도달했습니다" 경고
- **결과**: 성능 유지 및 과도한 콘텐츠 방지

### 4-4. 이미지 업로드
- **조건**: 이미지 블록 추가 시
- **규칙**: 
  - 파일 형식: JPG, PNG, GIF만 허용
  - 파일 크기: 최대 10MB
  - 하나의 메뉴얼에 최대 50개 이미지
- **결과**: 조건 충족 시 이미지 업로드 완료

### 4-5. 계층 구조 제한
- **조건**: 메뉴얼 섹션 계층
- **규칙**: 최대 3단계 (대제목 > 소제목 > 하위 소제목)
- **결과**: 명확한 구조 유지

---

## 5. 메뉴얼 공유 규칙

### 5-1. 팀 내부 공유
- **조건**: 메뉴얼 소유자 또는 편집자
- **규칙**: 
  - 팀원 선택 후 권한 (편집자/뷰어) 부여
  - 공유받은 팀원은 좌측 사이드바에서 메뉴얼 확인 가능
- **결과**: 선택된 팀원만 메뉴얼 접근 가능

### 5-2. 외부 공유 - 제목만 공개
- **조건**: 메뉴얼 소유자가 외부 공유 링크 생성
- **규칙**: 
  - 비회원 접속 시 제목 목록만 표시
  - 내용은 회원가입 후 열람 가능
- **결과**: 비회원에게 제목만 공개, 회원가입 유도

### 5-3. 외부 공유 - 전체 공개
- **조건**: 메뉴얼 소유자가 전체 공개 설정
- **규칙**: 
  - 비회원도 링크만 있으면 전체 내용 열람 가능
  - 편집은 불가, 읽기만 가능
- **결과**: 링크를 아는 모든 사람이 메뉴얼 열람 가능

### 5-4. 공유 링크 비활성화
- **조건**: 메뉴얼 소유자가 외부 공유 중단
- **규칙**: 링크 비활성화 시 즉시 접근 불가
- **결과**: 기존 공유 링크로 접속 시 "링크가 비활성화되었습니다" 안내

---

## 6. 권한 기반 접근 제어

### 6-1. 메뉴얼 읽기
- **조건**: 메뉴얼에 접근하려는 사용자
- **규칙**: 
  - 소유자/편집자/뷰어: 읽기 가능
  - 권한 없는 팀원: 접근 불가
  - 외부 공유 링크: 공유 설정에 따라 접근
- **결과**: 권한에 따라 읽기 허용 또는 거부

### 6-2. 메뉴얼 편집
- **조건**: 메뉴얼 수정 시도
- **규칙**: 
  - 소유자/편집자: 편집 가능
  - 뷰어: 편집 불가 (읽기 전용)
- **결과**: 권한에 따라 편집 모드 또는 읽기 모드 표시

### 6-3. 메뉴얼 삭제
- **조건**: 메뉴얼 삭제 시도
- **규칙**: 소유자만 삭제 가능
- **결과**: 권한 없으면 삭제 버튼 비활성화

### 6-4. 팀 관리 접근
- **조건**: 팀 관리 메뉴 접근 시도
- **규칙**: 소유자만 접근 가능
- **결과**: 편집자/뷰어는 "권한이 없습니다" 메시지

---

## 7. 버전 관리 규칙

### 7-1. 버전 자동 생성
- **조건**: 메뉴얼 편집 후 5초 경과
- **규칙**: 
  - 자동 저장 시 버전 이력 생성
  - 작성자 및 시간 기록
- **결과**: 버전 이력 목록에 추가

### 7-2. 버전 보관 기간
- **조건**: 생성된 버전 이력
- **규칙**: 
  - 최대 30일간 보관
  - 30일 경과 후 자동 삭제 (최신 버전은 유지)
- **결과**: 불필요한 데이터 자동 정리

### 7-3. 버전 되돌리기
- **조건**: 사용자가 이전 버전으로 복원 시도
- **규칙**: 
  - 편집자 이상 권한 필요
  - 현재 버전도 새로운 버전으로 이력에 저장
- **결과**: 이전 버전으로 메뉴얼 복원 및 이력 보존

### 7-4. 버전 비교
- **조건**: 두 버전 간 차이 확인
- **규칙**: 
  - 추가된 내용: 초록색 하이라이트
  - 삭제된 내용: 빨간색 취소선
  - 변경된 내용: 노란색 하이라이트
- **결과**: 시각적으로 변경 사항 파악 가능

---

## 8. 데이터 보존 및 삭제 규칙

### 8-1. 메뉴얼 삭제
- **조건**: 소유자가 메뉴얼 삭제
- **규칙**: 
  - 삭제 확인 모달 표시
  - 삭제된 메뉴얼은 7일간 휴지통 보관
  - 7일 후 영구 삭제
- **결과**: 실수로 삭제 시 복구 가능

### 8-2. 팀원 내보내기 후 데이터
- **조건**: 팀원이 팀에서 제외됨
- **규칙**: 
  - 해당 사용자가 작성한 메뉴얼은 팀에 유지
  - 작성자 이름은 "탈퇴한 사용자"로 표시
- **결과**: 협업 내용 보존

### 8-3. 팀 삭제
- **조건**: 소유자가 팀 삭제
- **규칙**: 
  - 팀명 입력 확인 후 즉시 영구 삭제
  - 모든 메뉴얼 및 버전 이력 삭제
  - 복구 불가
- **결과**: 모든 데이터 완전 삭제

---

## 9. 알림 규칙

### 9-1. 메뉴얼 공유 알림
- **조건**: 팀원이 메뉴얼을 공유받음
- **규칙**: 실시간 알림 + 이메일 알림 (설정에 따라)
- **결과**: "새 메뉴얼이 공유되었습니다" 알림

### 9-2. 팀 초대 알림
- **조건**: 이메일로 팀 초대받음
- **규칙**: 이메일 알림 + 링크 클릭 시 회원가입/로그인 유도
- **결과**: 초대 수락 유도

### 9-3. 권한 변경 알림
- **조건**: 팀원의 권한이 변경됨
- **규칙**: 실시간 알림
- **결과**: "권한이 [편집자/뷰어]로 변경되었습니다" 알림

### 9-4. 메뉴얼 수정 알림
- **조건**: 공유받은 메뉴얼이 다른 사용자에 의해 수정됨
- **규칙**: 
  - 뷰어에게는 알림 없음
  - 편집자/소유자에게만 알림
- **결과**: "메뉴얼이 수정되었습니다" 알림

---

## 10. 성능 및 제한 규칙

### 10-1. 팀원 수 제한
- **조건**: 팀 생성 또는 팀원 초대
- **규칙**: 한 팀에 최대 50명까지 팀원 추가 가능
- **결과**: 50명 초과 시 "팀원 수 제한에 도달했습니다" 경고

### 10-2. 메뉴얼 수 제한
- **조건**: 팀 내 메뉴얼 생성
- **규칙**: 한 팀에 최대 200개 메뉴얼 생성 가능
- **결과**: 제한 초과 시 "메뉴얼 수 제한에 도달했습니다" 경고

### 10-3. 동시 편집 충돌
- **조건**: 여러 사용자가 동시에 같은 메뉴얼 편집
- **규칙**: 
  - 먼저 저장된 변경사항 우선 반영
  - 충돌 발생 시 "다른 사용자가 수정 중입니다" 경고
- **결과**: 충돌 방지 메커니즘 작동

### 10-4. 자동 로그아웃
- **조건**: 30일간 로그인 활동 없음
- **규칙**: 보안을 위해 자동 로그아웃
- **결과**: 다음 접속 시 재로그인 필요

---

## 11. 검색 및 필터 규칙

### 11-1. 메뉴얼 검색
- **조건**: 대시보드에서 검색어 입력
- **규칙**: 
  - 제목, 내용, 작성자 이름으로 검색
  - 권한 있는 메뉴얼만 검색 결과 표시
- **결과**: 검색 결과 목록 표시

### 11-2. 최근 본 메뉴얼
- **조건**: 사용자가 메뉴얼 열람
- **규칙**: 
  - 최근 열람한 5개 메뉴얼 표시
  - 사이드바 상단에 배치
- **결과**: 빠른 재접근 가능

---

## 의사결정 플로우 요약

| 상황 | 조건 | 결과 |
|------|------|------|
| 회원가입 | 이메일 중복 없음 + 약관 동의 | 계정 생성 성공 |
| 팀 가입 | 이미 다른 팀 소속 | 초대 거절 |
| 메뉴얼 편집 | 뷰어 권한 | 읽기 전용 모드 |
| 메뉴얼 삭제 | 소유자 권한 | 삭제 실행 |
| 외부 공유 | 제목만 공개 설정 | 비회원에게 제목만 표시 |
| 버전 되돌리기 | 편집자 이상 권한 | 이전 버전 복원 |
| 팀 삭제 | 팀명 입력 일치 | 모든 데이터 영구 삭제 |

---

이 비즈니스 규칙은 개발자가 로직을 구현하고, QA 팀이 테스트 시나리오를 작성하는 데 참고 자료로 활용됩니다.
